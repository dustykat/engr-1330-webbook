<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Image Classification Project (under development) - ENGR-1330 Fall 2021</title>
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../../..">ENGR-1330 Fall 2021</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../../..">Home</a>
                            </li>
                            <li >
                                <a href="../../../0-Syllabus/ENGR-1330-2021-1-Syllabus/">Syllabus</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Lessons and Labs <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#">Introduction</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">Computational Thinking and Data Science</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../1-Lessons/Lesson00/lesson0/">Lesson 0</a>
</li>
            
<li >
    <a href="../../../8-Labs/Lab0/Lab0_Dev/">Laboratory 0</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Problem Solving with Computational Thinking</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../1-Lessons/Lesson01/lesson1/">Lesson 1</a>
</li>
            
<li >
    <a href="../../../8-Labs/Lab1/Lab1_Dev/">Laboratory 1</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Programming Fundamentals</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">Arithmetic</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../1-Lessons/Lesson02/lesson2/">Lesson 2</a>
</li>
            
<li >
    <a href="../../../8-Labs/Lab2/Lab2_Dev/">Laboratory 2</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Data Structures</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../1-Lessons/Lesson03/lesson3/">Lesson 3</a>
</li>
            
<li >
    <a href="../../../8-Labs/Lab3/Lab3_Dev/">Laboratory 3</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Flow Control Structures</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../1-Lessons/Lesson04/lesson4/">Lesson 4</a>
</li>
            
<li >
    <a href="../../../8-Labs/Lab4/Lab4_Dev/">Laboratory 4</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Data Files</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../lesson0/lesson0/">Lesson 5</a>
</li>
            
<li >
    <a href="../../../8-Labs/Lab5/Lab5_Dev/">Laboratory 5</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">External Functions and Modules</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../lesson0/lesson0/">Lesson 6</a>
</li>
            
<li >
    <a href="../../../8-Labs/Lab6/Lab6_Dev/">Laboratory 6</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Data Structures using NUMPY</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../1-Lessons/Lesson07/lesson6/">Lesson 7</a>
</li>
            
<li >
    <a href="../../../8-Labs/Lab7/Lab7_Dev/">Laboratory 1</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Data Frames using PANDAS</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../1-Lessons/Lesson08/lesson7/">Lesson 8</a>
</li>
            
<li >
    <a href="../../../8-Labs/Lab8/Lab8_Dev/">Laboratory 8</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Data Display using MATPLOTLIB</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../1-Lessons/Lesson09/lesson8/">Lesson 9</a>
</li>
            
<li >
    <a href="../../../8-Labs/Lab9/Lab9_Dev/">Laboratory 9</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Engineering Computation</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">Implicit Equations</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../1-Lessons/Lesson10/lesson10/">Lesson 10</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Interpolation and Integration</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../1-Lessons/Lesson11/lesson11/">Lesson 11</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Linear Equation Systems</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../1-Lessons/Lesson12/lesson12/">Lesson 12</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Non-Linear Equation System</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../1-Lessons/Lesson13/lesson13/">Lesson 13</a>
</li>
            
<li >
    <a href="../../../8-Labs/Lab13/Lab13_Dev/">Laboratory 13</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Data Models and Decisions</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">Models and Causality</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../lesson0/lesson0/">Lesson 14</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Descriptive Statistics</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../1-Lessons/Lesson15/lesson15/">Lesson 15</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Probability Distributions</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../lesson0/lesson0/">Lesson 16</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Probability Estimation Models</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../1-Lessons/Lesson17/lesson17/">Lesson 17</a>
</li>
            
<li >
    <a href="../../../8-Labs/Lab17/Lab17_Dev/">Laboratory 17</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Hypothesis Testing</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../lesson0/lesson0/">Lesson 18</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Interval Estimates</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../lesson0/lesson0/">Lesson 19</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Prediction Engines</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">Visual Model Fitting</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../lesson0/lesson0/">Lesson 20</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Least Squares (Regression) Model Fitting</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../lesson0/lesson0/">Lesson 21</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Prediction Interval Estimates</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../lesson0/lesson0/">Lesson 22</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Logistic Regression</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../lesson0/lesson0/">Lesson 23</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Classification Engines</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">K Nearest Neighbor</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../lesson0/lesson0/">Lesson 24</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Support Vector Machines</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../lesson0/lesson0/">Lesson 25</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Artifical Neural Networks</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../lesson0/lesson0/">Lesson 26</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Homeworks/Project <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../2-Homework/ES1/es1-deploy/">Exercise Set 1</a>
</li>
                                    
<li >
    <a href="../../../2-Homework/ES2/es2-deploy/">Exercise Set 2</a>
</li>
                                    
<li >
    <a href="../../../2-Homework/ES3/es3-deploy/">Exercise Set 3</a>
</li>
                                    
<li class="active">
    <a href="./">Image Classification Project (under development)</a>
</li>
                                    
<li >
    <a href="../../P-InstrumentCalibration/InstrumentCalibration-Project/">Instrument Calibration Project (reference links need update)</a>
</li>
                                    
<li >
    <a href="../../P-MusicClassification/genre-classification-project-problem/">Music Classification Project (reference links need update)</a>
</li>
                                    
<li >
    <a href="../../P-ConcreteStrength/ConcreteStrength-Project/">Concrete Strength Prediction Project (reference links need update)</a>
</li>
                                    
<li >
    <a href="../../P-DTMF/DTMF-Part1/">Audio File Analysis Project (under development)</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../../../2-Homework/ES3/es3-deploy/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../../P-InstrumentCalibration/InstrumentCalibration-Project/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#warning">Warning!!</a></li>
        <li class="main "><a href="#artifical-neural-network">Artifical Neural Network</a></li>
            <li><a href="#classification">Classification</a></li>
            <li><a href="#things-to-do">Things to do</a></li>
            <li><a href="#explain-training">Explain Training</a></li>
            <li><a href="#explain-testing">Explain Testing</a></li>
            <li><a href="#explain-using-own-images">Explain using own images</a></li>
            <li><a href="#references">References</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<pre><code class="python">import sys
print(&quot;Echo system status -- reset environment if kernel NOT 3.8...&quot;)
print(sys.executable)
print(sys.version)
print(sys.version_info)
# testing on aws lightsail instance 21 July 2020
</code></pre>

<pre><code>Echo system status -- reset environment if kernel NOT 3.8...
/opt/jupyterhub/bin/python3
3.6.9 (default, Oct  8 2020, 12:12:24) 
[GCC 8.4.0]
sys.version_info(major=3, minor=6, micro=9, releaselevel='final', serial=0)
</code></pre>
<h1 id="warning">Warning!!</h1>
<p><strong>This notebook takes a long time to run (3+ minutes on 1GB/1CPU/2GHz)</strong></p>
<h1 id="artifical-neural-network">Artifical Neural Network</h1>
<p>From Wikipedia:</p>
<p>An artificial neural network is an interconnected group of nodes, inspired by a simplification of neurons in a brain. Here, each circular node represents an artificial neuron and an arrow represents a connection from the output of one artificial neuron to the input of another.
Artificial neural networks (ANN) or connectionist systems are computing systems vaguely inspired by the biological neural networks that constitute animal brains. 
Such systems "learn" to perform tasks by considering examples, generally without being programmed with task-specific rules. For example, in image recognition, they might learn to identify images that contain cats by analyzing example images that have been manually labeled as "cat" or "no cat" and using the results to identify cats in other images. 
They do this without any prior knowledge of cats, for example, that they have fur, tails, whiskers and cat-like faces. 
Instead, they automatically generate identifying characteristics from the examples that they process.</p>
<p>An ANN is based on a collection of connected units or nodes called artificial neurons, which loosely model the neurons in a biological brain. Each connection, like the synapses in a biological brain, can transmit a signal to other neurons. An artificial neuron that receives a signal then processes it and can signal neurons connected to it.</p>
<p>In ANN implementations, the "signal" at a connection is a real number, and the output of each neuron is computed by some non-linear function of the sum of its inputs. The connections are called edges. Neurons and edges typically have a weight that adjusts as learning proceeds. The weight increases or decreases the strength of the signal at a connection. Neurons may have a threshold such that a signal is sent only if the aggregate signal crosses that threshold. Typically, neurons are aggregated into layers. Different layers may perform different transformations on their inputs. Signals travel from the first layer (the input layer), to the last layer (the output layer), possibly after traversing the layers multiple times.</p>
<p>The original goal of the ANN approach was to solve problems in the same way that a human brain would. But over time, attention moved to performing specific tasks, leading to deviations from biology. ANNs have been used on a variety of tasks, including computer vision, speech recognition, machine translation, social network filtering, playing board and video games, medical diagnosis, and even in activities that have traditionally been considered as reserved to humans, like painting.</p>
<p>First some set-up, for the next part of the background:</p>
<pre><code class="python">import numpy              # useful numerical routines
import scipy.special      # special functions library
import scipy.misc         # image processing code
import imageio
import matplotlib.pyplot  # import plotting routines
</code></pre>

<h2 id="classification">Classification</h2>
<p>Computers are nothing more than calculators at heart. They are very very fast at doing  arithmetic.  This is great for doing tasks that match what a calculator does: summing numbers to work out sales, applying percentages to work out tax, plotting graphs of existing data.<br />
Even watching catchup TV or streaming music through your computer doesn’t involve much  more than the computer executing simple arithmetic instructions again and again. 
It may  surprise you but reconstructing a video frame from the ones and zeros that are piped across the  internet to your computer is done using arithmetic not much more complex than the sums we  did at school.<br />
Adding up numbers really quickly  thousands, or even millions of times a second  may be impressive  but it isn’t intelligence. </p>
<p>A human may find it hard to do large sums very quickly but the  process of doing it doesn’t require much intelligence at all. It simply requires an ability to follow  very basic instructions, and this is what the electronics inside a computer does.  Now let’s flips things and turn the tables on computers!  Look at the following images and see if you can recognise what they contain: </p>
<p><img alt="" src="../image_src/pictures.png" /></p>
<p>You can immediately recognize people, a cat, and a tree -- you are ably to classify the pictures very fast.
We can process the quite large amount of information that the images contain, and very  successfully process it to recognise what’s in the image. This kind of task isn’t easy for  computers  in fact it’s incredibly difficult. </p>
<p>Consider what happens when we reduce the information into a 27X27 pixel map to see one reason why classification is hard for a machine -- a resolution issue, also we will see how at reduce resolution the pictures look alike.</p>
<p>First render the people image in reduced resolution about 1/2 of the original -- still barely recognizable for us humans</p>
<pre><code class="python">img_array = imageio.imread(&quot;image_src/people784.png&quot;, as_gray = True)
img_data0 = 255.0 - img_array.reshape(784)
img_data0 = ((img_data0/255.0)*0.99) + 0.01
matplotlib.pyplot.imshow(numpy.asfarray(img_data0).reshape((28,28)),cmap = 'Greys') # construct a graphic object #
matplotlib.pyplot.show() # show the graphic object to a window #
matplotlib.pyplot.close('all')
</code></pre>

<p><img alt="png" src="../output_5_0.png" /></p>
<pre><code class="python">print(&quot;people784 statistics : &quot;,img_data0.mean(),img_data0.var())
</code></pre>

<pre><code>people784 statistics :  0.48325375 0.06275265
</code></pre>
<p>Now render the cat image in reduced resolution about 1/2 of the original -- still  recognizable for us humans</p>
<pre><code class="python">img_array = imageio.imread(&quot;image_src/cat784.png&quot;, as_gray = True)
img_data1 = 255.0 - img_array.reshape(784)
img_data1 = ((img_data1/255.0)*0.99) + 0.01
matplotlib.pyplot.imshow(numpy.asfarray(img_data1).reshape((28,28)),cmap = 'Greys') # construct a graphic object #
matplotlib.pyplot.show() # show the graphic object to a window #
matplotlib.pyplot.close('all')
</code></pre>

<p><img alt="png" src="../output_8_0.png" /></p>
<pre><code class="python">print(&quot;cat784 statistics : &quot;,img_data1.mean(),img_data1.var())
</code></pre>

<pre><code>cat784 statistics :  0.60355407 0.023282547
</code></pre>
<p>Now render the tree image in reduced resolution about 1/3 of the original -- still  recognizable for us humans</p>
<pre><code class="python">img_array = imageio.imread(&quot;image_src/tree784.png&quot;, as_gray = True)
img_data2 = 255.0 - img_array.reshape(784)
img_data2 = ((img_data2/255.0)*0.99) + 0.01
matplotlib.pyplot.imshow(numpy.asfarray(img_data2).reshape((28,28)),cmap = 'Greys') # construct a graphic object #
matplotlib.pyplot.show() # show the graphic object to a window #
matplotlib.pyplot.close('all')
</code></pre>

<p><img alt="png" src="../output_11_0.png" /></p>
<pre><code class="python">print(&quot;tree784 statistics : &quot;,img_data2.mean(),img_data2.var())
</code></pre>

<pre><code>tree784 statistics :  0.484061 0.049499817
</code></pre>
<p>Using the image statistics, which is just the gray-scale value of each pixel (0-254), we see that the images are different with this simple metric but not by much</p>
<pre><code>Image       Mean           Variance
People    0.48325375     0.06275265
Cat       0.60355407     0.023282547
Tree      0.484061       0.049499817
</code></pre>
<p>If we used just a statistical description, in the mean people and tree are the same, whereas a cat is different. But not all cats will have the same mean (or variance).  So simplistic numerical descriptors are useless, we need more that a couple of metrics for the image perhaps higher moments, or a way to consider all pixels at once -- sort of like a regression model. </p>
<p>We humans naturally fill in missing information and can classify very fast  -- cognative scientists think (now thats a pun!) that our mind performs "regressions" on the whole image and reduces it to a set of classifiers then these are compared in our brain to historical results and the classification that throw off the most dopamine (our brain's drug of choice) is selected.  It happens fast because the chemical reactions involved can be processed in parallel, the message is sent evreywhere at once and the molecules themselves don't even have to arrive for the classification to occur.</p>
<h2 id="things-to-do">Things to do</h2>
<p>link videos
- explain prediction vs clasification
- explain neuron functions
- ANN </p>
<p>write ups/future fixes</p>
<ul>
<li>modify so my photos can be added to a training file</li>
<li>modify so can ask for filenames</li>
<li>modify so can render images and send output to PDF/PNG files</li>
<li>modify to do something engineering useful -- like partition watersheds into developed, undeveloped and a few other classes based on GoogleEarth image captures</li>
</ul>
<pre><code class="python">(28054)**(1/2) #not sure why I put this here, looks like figuring pixel counts
</code></pre>

<pre><code>167.49328344742662
</code></pre>
<h3 id="define-the-ann-class">Define the ANN class</h3>
<p>Need write up on OOP and why using classes.</p>
<pre><code class="python">
</code></pre>

<pre><code class="python">class neuralNetwork:  # Class Definitions 

    # initialize the neural network
    def __init__(self, inputnodes, hiddennodes, outputnodes, learningrate):
        # set number of nodes in input, hidden, and output layer
        self.inodes = inputnodes
        self.hnodes = hiddennodes
        self.onodes = outputnodes

        # learning rate
        self.lr = learningrate

        # initalize weight matrices
        #
        # link weight matrices, wih (input to hidden) and
        #                       who (hidden to output)
        # weights inside the arrays are w_i_j where link is from node i
        # to node j in next layer
        #
        # w11 w21
        # w12 w22 etc.

        self.wih = (numpy.random.rand(self.hnodes, self.inodes) - 0.5)
        self.who = (numpy.random.rand(self.onodes, self.hnodes) - 0.5)

        # activation function
        self.activation_function = lambda x:scipy.special.expit(x)
        pass

    # train the neural network
    def train(self, inputs_list, targets_list):
        # convert input list into 2D array
        inputs = numpy.array(inputs_list, ndmin=2).T

        # convert target list into 2D array
        targets = numpy.array(targets_list, ndmin=2).T

        # calculate signals into hidden layer
        hidden_inputs = numpy.dot(self.wih, inputs)

        # calculate signals from hidden layer
        hidden_outputs = self.activation_function(hidden_inputs)

        # calculate signals into output layer
        final_inputs = numpy.dot(self.who, hidden_outputs)

        # calculate signals from output layer
        final_outputs = self.activation_function(final_inputs)

        # calculate output errors (target - model)
        output_errors = targets - final_outputs

        # calculate hidden layer errors (split by weigths recombined in hidden layer)
        hidden_errors = numpy.dot(self.who.T, output_errors)

        # update the weights for the links from hidden to output layer
        self.who += self.lr * numpy.dot((output_errors * final_outputs * (1.0 - final_outputs)), numpy.transpose(hidden_outputs))

        # update the weights for the links from input to hidden layer
        self.wih += self.lr * numpy.dot((hidden_errors * hidden_outputs * (1.0 - hidden_outputs)), numpy.transpose(inputs))                                       

        pass

    # query the neural network
    def query(self, inputs_list):
        # convert input list into 2D array
        inputs = numpy.array(inputs_list, ndmin=2).T

        # calculate signals into hidden layer
        hidden_inputs = numpy.dot(self.wih, inputs)

        # calculate signals from hidden layer
        hidden_outputs = self.activation_function(hidden_inputs)

        # calculate signals into output layer
        final_inputs = numpy.dot(self.who, hidden_outputs)

        # calculate signals from output layer
        final_outputs = self.activation_function(final_inputs)

        return final_outputs

        pass
print(&quot;neuralNetwork Class Loads OK&quot;)
</code></pre>

<pre><code>neuralNetwork Class Loads OK
</code></pre>
<h3 id="explain-why-a-test-case">Explain why a test case</h3>
<pre><code class="python"># Test case 1 p130 MYONN
# number of input, hidden, and output nodes
input_nodes  = 784    # 28X28 Pixel Image 
hidden_nodes = 110    # Should be smaller than input count (or kind of useless)
output_nodes =  10    # Classifications
learning_rate = 0.1   # set learning rate
n = neuralNetwork(input_nodes,hidden_nodes,output_nodes,learning_rate) # create an instance
print(&quot;Instance n Created&quot;)
</code></pre>

<pre><code>Instance n Created
</code></pre>
<h2 id="explain-training">Explain Training</h2>
<h3 id="explain-concept-of-learning-rate-and-training-episodes-kind-of-a-bootstrap-here">Explain Concept of Learning Rate and Training Episodes (kind of a bootstrap here!)</h3>
<pre><code class="python"># load a training file
# replace code here with a URL get
## training_data_file = open(&quot;mnist_train_100.csv&quot;,'r') #connect the file#
training_data_file = open(&quot;mnist_train.csv&quot;,'r') #connect the file#
training_data_list = training_data_file.readlines() #read entire contents of file into object: data_list#
training_data_file.close() #disconnect the file#
# print(len(training_data_list))   ## activate for debugging otherwise leave disabled
# train the neural network
howManyTrainingTimes = 0
for times in range(0,1):  # added outer loop for repeat training same data set
    howManyTrainingRecords = 0
    for record in training_data_list:
    # split the values on the commas
        all_values = record.split(',') # split datalist on commas - all records.  Is thing going to work? #
        inputs = (numpy.asfarray(all_values[1:])/255.0 * 0.99) + 0.01
#        inputs = (numpy.asfarray(all_values[1:])/255.0 * 0.99) + 0.01
    # print(inputs)          ## activate for debugging otherwise leave disabled
    # create target output values -- all 0.01 except for the label of 0.99
        targets = numpy.zeros(output_nodes) + 0.01
    # all_values[0] is the target for this record
        targets[int(all_values[0])] = 0.99
        n.train(inputs, targets)
        howManyTrainingRecords += 1
        pass
    howManyTrainingTimes += 1
    learning_rate *= 0.9
    pass
print (&quot;training records processed   = &quot;,howManyTrainingRecords)
print (&quot;training episodes            = &quot;,howManyTrainingTimes)
# load a production file
## test_data_file = open(&quot;mnist_test_10.csv&quot;,'r') #connect the file#
test_data_file = open(&quot;mnist_test.csv&quot;,'r') #connect the file#
test_data_list = test_data_file.readlines() #read entire contents of file into object: data_list#
test_data_file.close() #disconnect the file#
</code></pre>

<pre><code>training records processed   =  60000
training episodes            =  1
</code></pre>
<p><strong>Runtime above cell ~ 3 minutes on AWS 1GB/1CPU/2GHz virtual machine</strong></p>
<h2 id="explain-testing">Explain Testing</h2>
<pre><code class="python"># test the neural network
scorecard = [] # empty array for keeping score

# run through the records in test_data_list
howManyTestRecords = 0
for record in test_data_list:
    # split the values on the commas
    all_values = record.split(',') # split datalist on commas - all records #
    correct_label = int(all_values[0]) # correct answer is first element of all_values
    # scale and shift the inputs
    inputs = (numpy.asfarray(all_values[1:])/255.0 * 0.99) + 0.01
    # query the neural network
    outputs = n.query(inputs)
    predict_label = numpy.argmax(outputs)
    ##    print &quot;predict =&quot;,predict_label,correct_label,&quot;= correct&quot; # activate for small test sets only!
    if (predict_label == correct_label):
        scorecard.append(1)
    else:
        scorecard.append(0)
        pass
    howManyTestRecords += 1
    pass
print (&quot;production records processed =&quot;, howManyTestRecords)
## print scorecard   # activate for small test sets only!
# calculate performance score, fraction of correct answers
scorecard_array = numpy.asfarray(scorecard)
print (&quot;performance = &quot;,scorecard_array.sum()/scorecard_array.size)
</code></pre>

<pre><code>production records processed = 10000
performance =  0.9472
</code></pre>
<h2 id="explain-using-own-images">Explain using own images</h2>
<p>How were images obtained?</p>
<p>How are they pre-processed to get 28x28 size? (GraphicConverter and linear aggregation) -- This can probably be done in python subsystem (function) this worksheet.</p>
<p>Why are the colors and alpha-channel squashed into greyscale?</p>
<p>Play with the training episodes - see if can get 90% recognition (9/10) correct.  Examine failed recognition, try to explain why.</p>
<pre><code class="python"># lets try one of my own pictures
# first read and render
#img_array = scipy.misc.imread(&quot;MyZero.png&quot;, flatten = True) Fuckers deprecated this utility!
img_array = imageio.imread(&quot;image_src/MyZero.png&quot;, as_gray = True)
img_data = 255.0 - img_array.reshape(784)
img_data = ((img_data/255.0)*0.99) + 0.01
matplotlib.pyplot.imshow(numpy.asfarray(img_data).reshape((28,28)),cmap = 'Greys') # construct a graphic object #
matplotlib.pyplot.show() # show the graphic object to a window #
matplotlib.pyplot.close('all')

mynumber = n.query(img_data)
mylabel = numpy.argmax(mynumber)

print (&quot;my number = 0 &quot;,&quot;my network thinks its = &quot;,mylabel)
</code></pre>

<p><img alt="png" src="../output_25_0.png" /></p>
<pre><code>my number = 0  my network thinks its =  0
</code></pre>
<pre><code class="python">m0=img_data.mean()
v0=img_data.var()
</code></pre>

<pre><code class="python">#first read and render
img_array = imageio.imread(&quot;image_src/MyOne.png&quot;, as_gray = True)
img_data = 255.0 - img_array.reshape(784)
img_data = ((img_data/255.0)*0.99) + 0.01
matplotlib.pyplot.imshow(numpy.asfarray(img_data).reshape((28,28)),cmap = 'Greys') # construct a graphic object #
matplotlib.pyplot.show() # show the graphic object to a window #
matplotlib.pyplot.close('all')

mynumber = n.query(img_data)
mylabel = numpy.argmax(mynumber)

print (&quot;my number = 1 &quot;,&quot;my network thinks its = &quot;,mylabel)
</code></pre>

<p><img alt="png" src="../output_27_0.png" /></p>
<pre><code>my number = 1  my network thinks its =  1
</code></pre>
<pre><code class="python">m1=img_data.mean()
v1=img_data.var()
</code></pre>

<pre><code class="python">#first read and render
img_array = imageio.imread(&quot;image_src/MyTwo.png&quot;, as_gray = True)
img_data = 255.0 - img_array.reshape(784)
img_data = ((img_data/255.0)*0.99) + 0.01
matplotlib.pyplot.imshow(numpy.asfarray(img_data).reshape((28,28)),cmap = 'Greys') # construct a graphic object #
matplotlib.pyplot.show() # show the graphic object to a window #
matplotlib.pyplot.close('all')

mynumber = n.query(img_data)
mylabel = numpy.argmax(mynumber)

print (&quot;my number = 2 &quot;,&quot;my network thinks its = &quot;,mylabel)
</code></pre>

<p><img alt="png" src="../output_29_0.png" /></p>
<pre><code>my number = 2  my network thinks its =  2
</code></pre>
<pre><code class="python">m2=img_data.mean()
v2=img_data.var()
</code></pre>

<pre><code class="python">#first read and render
img_array = imageio.imread(&quot;image_src/MyThree.png&quot;, as_gray = True)
img_data = 255.0 - img_array.reshape(784)
img_data = ((img_data/255.0)*0.99) + 0.01
matplotlib.pyplot.imshow(numpy.asfarray(img_data).reshape((28,28)),cmap = 'Greys') # construct a graphic object #
matplotlib.pyplot.show() # show the graphic object to a window #
matplotlib.pyplot.close('all')
mynumber = n.query(img_data)
mylabel = numpy.argmax(mynumber)

print (&quot;my number = 3 &quot;,&quot;my network thinks its = &quot;,mylabel)
</code></pre>

<p><img alt="png" src="../output_31_0.png" /></p>
<pre><code>my number = 3  my network thinks its =  3
</code></pre>
<pre><code class="python">m3=img_data.mean()
v3=img_data.var()
</code></pre>

<pre><code class="python">#first read and render
img_array = imageio.imread(&quot;image_src/MyFour.png&quot;, as_gray = True)
img_data = 255.0 - img_array.reshape(784)
img_data = ((img_data/255.0)*0.99) + 0.01
matplotlib.pyplot.imshow(numpy.asfarray(img_data).reshape((28,28)),cmap = 'Greys') # construct a graphic object #
matplotlib.pyplot.show() # show the graphic object to a window #
matplotlib.pyplot.close('all')

mynumber = n.query(img_data)
mylabel = numpy.argmax(mynumber)

print (&quot;my number = 4 &quot;,&quot;my network thinks its = &quot;,mylabel)
</code></pre>

<p><img alt="png" src="../output_33_0.png" /></p>
<pre><code>my number = 4  my network thinks its =  4
</code></pre>
<pre><code class="python">m4=img_data.mean()
v4=img_data.var()
</code></pre>

<pre><code class="python">#first read and render
img_array = imageio.imread(&quot;image_src/MyFive.png&quot;, as_gray = True)
img_data = 255.0 - img_array.reshape(784)
img_data = ((img_data/255.0)*0.99) + 0.01
matplotlib.pyplot.imshow(numpy.asfarray(img_data).reshape((28,28)),cmap = 'Greys') # construct a graphic object #
matplotlib.pyplot.show() # show the graphic object to a window #
matplotlib.pyplot.close('all')

mynumber = n.query(img_data)
mylabel = numpy.argmax(mynumber)

print (&quot;my number = 5 &quot;,&quot;my network thinks its = &quot;,mylabel)
</code></pre>

<p><img alt="png" src="../output_35_0.png" /></p>
<pre><code>my number = 5  my network thinks its =  5
</code></pre>
<pre><code class="python">m5=img_data.mean()
v5=img_data.var()
</code></pre>

<pre><code class="python">#first read and render
img_array = imageio.imread(&quot;image_src/MySix.png&quot;, as_gray = True)
img_data = 255.0 - img_array.reshape(784)
img_data = ((img_data/255.0)*0.99) + 0.01
matplotlib.pyplot.imshow(numpy.asfarray(img_data).reshape((28,28)),cmap = 'Greys') # construct a graphic object #
matplotlib.pyplot.show() # show the graphic object to a window #
matplotlib.pyplot.close('all')

mynumber = n.query(img_data)
mylabel = numpy.argmax(mynumber)

print (&quot;my number = 6 &quot;,&quot;my network thinks its = &quot;,mylabel)

</code></pre>

<p><img alt="png" src="../output_37_0.png" /></p>
<pre><code>my number = 6  my network thinks its =  5
</code></pre>
<pre><code class="python">m6=img_data.mean()
v6=img_data.var()
</code></pre>

<pre><code class="python">#first read and render
img_array = imageio.imread(&quot;image_src/MySeven.png&quot;, as_gray = True)
img_data = 255.0 - img_array.reshape(784)
img_data = ((img_data/255.0)*0.99) + 0.01
matplotlib.pyplot.imshow(numpy.asfarray(img_data).reshape((28,28)),cmap = 'Greys') # construct a graphic object #
matplotlib.pyplot.show() # show the graphic object to a window #
matplotlib.pyplot.close('all')

mynumber = n.query(img_data)
mylabel = numpy.argmax(mynumber)

print (&quot;my number = 7 &quot;,&quot;my network thinks its = &quot;,mylabel)
</code></pre>

<p><img alt="png" src="../output_39_0.png" /></p>
<pre><code>my number = 7  my network thinks its =  7
</code></pre>
<pre><code class="python">m7=img_data.mean()
v7=img_data.var()
</code></pre>

<pre><code class="python">#first read and render
img_array = imageio.imread(&quot;image_src/MyEight.png&quot;, as_gray = True)
img_data = 255.0 - img_array.reshape(784)
img_data = ((img_data/255.0)*0.99) + 0.01
matplotlib.pyplot.imshow(numpy.asfarray(img_data).reshape((28,28)),cmap = 'Greys') # construct a graphic object #
matplotlib.pyplot.show() # show the graphic object to a window #
matplotlib.pyplot.close('all')

mynumber = n.query(img_data)
mylabel = numpy.argmax(mynumber)

print (&quot;my number = 8 &quot;,&quot;my network thinks its = &quot;,mylabel)
</code></pre>

<p><img alt="png" src="../output_41_0.png" /></p>
<pre><code>my number = 8  my network thinks its =  8
</code></pre>
<pre><code class="python">m8=img_data.mean()
v8=img_data.var()
</code></pre>

<pre><code class="python">#first read and render
img_array = imageio.imread(&quot;image_src/MyNine.png&quot;, as_gray = True)
img_data = 255.0 - img_array.reshape(784)
img_data = ((img_data/255.0)*0.99) + 0.01
matplotlib.pyplot.imshow(numpy.asfarray(img_data).reshape((28,28)),cmap = 'Greys') # construct a graphic object #
matplotlib.pyplot.show() # show the graphic object to a window #
matplotlib.pyplot.close('all')

mynumber = n.query(img_data)
mylabel = numpy.argmax(mynumber)

print (&quot;my number = 9 &quot;,&quot;my network thinks its = &quot;,mylabel)
pass    

</code></pre>

<p><img alt="png" src="../output_43_0.png" /></p>
<pre><code>my number = 9  my network thinks its =  9
</code></pre>
<pre><code class="python">m9=img_data.mean()
v9=img_data.var()


print(&quot;my 0 statistics : &quot;,m0,v0)
print(&quot;my 1 statistics : &quot;,m1,v1)
print(&quot;my 2 statistics : &quot;,m2,v2)
print(&quot;my 3 statistics : &quot;,m3,v3)
print(&quot;my 4 statistics : &quot;,m4,v4)
print(&quot;my 5 statistics : &quot;,m5,v5)
print(&quot;my 6 statistics : &quot;,m6,v6)
print(&quot;my 7 statistics : &quot;,m7,v7)
print(&quot;my 8 statistics : &quot;,m8,v8)
print(&quot;my 9 statistics : &quot;,m9,v9)
</code></pre>

<pre><code>my 0 statistics :  0.10840577 0.07128458
my 1 statistics :  0.0691415 0.045747854
my 2 statistics :  0.10085894 0.06906258
my 3 statistics :  0.15961523 0.071290515
my 4 statistics :  0.1313567 0.06362193
my 5 statistics :  0.11012904 0.07498277
my 6 statistics :  0.18414135 0.09940878
my 7 statistics :  0.11907936 0.056603365
my 8 statistics :  0.12214256 0.08051322
my 9 statistics :  0.0691415 0.045747854
</code></pre>
<h2 id="references">References</h2>
<p>http://myselph.de/neuralNet.html</p>
<p>LazyProgrammer. Unsupervised Machine Learning in Python: Master Data Science and Machine Learning with Cluster Analysis, Gaussian Mixture Models, and Principal Components Analysis . Kindle Edition. </p>
<p>Rashid, Tariq. Make Your Own Neural Network. Kindle Edition. </p>
<p>https://www.digitalocean.com/community/tutorials/an-introduction-to-machine-learning</p>
<pre><code class="python">######## Useful Stuff Below ######################

##an_input_list = ([1.0,0.5,-1.5])
##print(&quot;Trying a Query - input list first&quot;)
##print(an_input_list)
##print(&quot;Now the response&quot;)
##print(n.query(an_input_list))
##print(&quot;Instance works up to pg 138&quot;)

### get a single test record
##all_values = test_data_list[0].split(',')
##print('classification for this test record = ', all_values[0])
####image_array = numpy.asfarray(all_values[1:]).reshape((28,28))
####matplotlib.pyplot.imshow(image_array) # construct a graphic object #
####matplotlib.pyplot.show() # show the graphic object to a window #
##print( n.query((numpy.asfarray(all_values[1:])/255.0 * 0.99) + 0.01) )

##image_array = numpy.asfarray(scaled_input).reshape((28,28))
##matplotlib.pyplot.imshow(image_array) # construct a graphic object #
##matplotlib.pyplot.show() # show the graphic object to a window #
##matplotlib.pyplot.imshow(image_array, cmap = 'Greys', interpolation = 'nearest' ) # construct a graphic object #
##matplotlib.pyplot.show() # show the graphic object to a window #
# 

</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" defer></script>
        <script src="../../../mathjaxhelper.js" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
